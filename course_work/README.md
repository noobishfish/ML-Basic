# Описание к Курсовой

## Цель

Обучить модель для рекомендации пользователям покупок в интернет магазине. Модель должна анализировать историю покупок 
пользователей и находить схожее поведение между разными пользователями. Например, если пользователи покупали товар N и 
с ним часто покупали товар M, то новому пользователю при покупке товара N будет тоже предложен товар M.

## Используемые данные

**Дата-сет**
[Retail Rocket](https://www.kaggle.com/datasets/retailrocket/ecommerce-dataset?resource=download)

Данный дата-сет содержит набор исторических данных о покупках в интернет магазинах. На основании этих данных можно 
обучить модель неявным связям в поведении пользователей.

*Примечание*
Git не позволяет залить в репозиторий дата-сет. Его можно скачать по ссылке выше. По умолчанию файлы из дата-сета 
располагаются в resources.

**Данные**

События (`events.csv`): `visitorid`, `itemid`, `event` (`view`, `addtocart`, `transaction`), `timestamp`.
Категории (`item_properties_part1.csv`, `item_properties_part2.csv`): `categoryid`

## Модель

ALS из библиотеки implicit.
Данная модель часто используется в рекомендательных системах.

## Описание реализации

Для оценки востребованности товара пользователем были выбраны следующие события из `events` и веса:

* `view` - просмотр товара. Вес 1.
* `addtocart` - добавление товара в корзину. Вес 3.
* `transaction` - покупка товара. Вес 5.

Таким образом приоритет в рекомендациях отдается товарам, которые были куплены, затем просмотренным товарам, затем 
просмотренным.

Для создания обучающих и тестовых наборов данных пользователи фильтруются по наличию у них 2-х и более покупок.

**Формирование матриц**

Матрицы формируются вида пользователи и товары, где ячейка = вес взаимодействия.

**Разделение на тестовые данные**

Для тестовых данных берем последнее событие пользователя.

**Рекомендации**

Для заданного пользователя система:
* берёт его эмбеддинг,
* умножает на эмбеддинги всех товаров,
* сортирует по убыванию,
* исключает уже просмотренные,
* возвращает топ самых релевантных.

**Визуализация**

Выводим график товаров.

### recal_at_k

Функция оценивает качество рекомендаций на тестовых данных. Какая доля реальных покупок (из теста) попала в топ K 
рекомендаций.

### load_item_categories

Получает данные о связках товаров и категорий. Отбрасывает все ненужные поля из `item_properties`.

### visualize_item_embeddings

Строит 2D-график, где каждый товар — точка, раскрашенная по категории. Отображается топ 10 товаров. 

## Вывод

1. Модель определила семантическое сходство товаров из данных о просмотрах и покупках.
2. Нет чётких кластеров для каждой категории. Это может быть вызвано тем, что пользователи покупают товары из нескольких 
разных категорий, а не из одной.
3. Есть небольшие отдельные группы. Это может быть ниша товаров, которую покупают одни и те же пользователи.
4. Поведение пользователей в датасете довольно однотипное — многие товары покупаются/просматриваются вместе.
5. Сложно разделить товары на чёткие группы без дополнительной информации. Нет точного определения паттерна покупки 
товара, на которые можно было бы дополнительно объединить группировку. Например, если категория товара кроссовки и 
спортивная сумка, то мы не можем применить группировку спортивные товары. Нужна дополнительная классификация категорий.

[Полученный график](item_embeddings_umap.png)